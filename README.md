# cocos-boilerplate-2d

## Описание

Это бойлерплейт для создания playable-ads (игровых креативов) на Cocos Creator с интеграцией собственного плагина для сборки и мультиканальной публикации.

---

## 2D Canvas и позиционирование элементов

- Основное разрешение 2D канваса: **1280x720** (горизонтально) или **720x1280** (вертикально). Это базовое разрешение для фона и большинства UI-элементов.
- Для позиционирования элементов рекомендуется использовать компонент **Widget**.
- Если стандартных возможностей Widget недостаточно (например, для сложных адаптаций под разные соотношения сторон), используйте абстрактный класс `RotatingComponent`:
  - Экстендите свои компоненты от `RotatingComponent`.
  - Реализуйте функцию `onRotate(width, height, ipad, iphoneX)`, чтобы управлять позиционированием и размерами элементов при изменении размера канваса.

Пример:
```ts
class MyComponent extends RotatingComponent {
  onRotate(width: number, height: number, ipad: number, iphoneX: number) {
    // ваша логика адаптации
  }
}
```

---

## Работа с текстом и изображениями

### Важно: не используйте файлы шрифтов

Не используйте в проекте файлы шрифтов (.ttf, .woff, .otf и другие), так как сеть Google блокирует их прямое использование в playable-ads. Для текстов используйте картинки или webfont.

### Ограничения по изображениям

При формировании изображений для playable-ads убедитесь, что ни одна из сторон не превышает 2048 пикселей. Это важно для корректной работы на всех платформах и соответствия требованиям сетей.

---

## Работа со звуками

Для проигрывания звуков и музыки необходимо:

1. В сцене должна быть нода `sounds`.
2. В эту ноду добавляются дочерние ноды с компонентом AudioSource для каждого звука/музыки.
3. Имя ноды используется как ключ для методов `playSound` и `playMusic`.
4. Обязательно снимайте галочку **Play On Awake** у всех AudioSource, чтобы звуки не проигрывались автоматически при запуске сцены.

Пример:
```ts
// Проиграть звук по имени ноды
PlayableComponent.instance.playSound('spin');

// Проиграть музыку по имени ноды
PlayableComponent.instance.playMusic('music');
```

---

## Использование PlayableComponent

`PlayableComponent` — основной компонент для управления поведением playable-ads. Находится в `assets/scripts/utils/PlayableComponent.ts`.

### Основные функции:

- **playSound(key: string)** — проигрывает звук по ключу (например, для эффектов).
- **playMusic(key: string)** — проигрывает фоновую музыку.
- **firstInteraction()** — должна вызываться при первом взаимодействии пользователя (разрешает проигрывание музыки/звуков).
- **CTAClick()** — обработчик клика по CTA (кнопке перехода в стор). Открывает ссылку из глобального `clickTag` или вызывает кастомный обработчик `onCTAClick`.

#### Пример интеграции CTA:

```ts
// Вызовите этот метод при клике на CTA-кнопку
PlayableComponent.instance.CTAClick();
```

- Если определена глобальная функция `onCTAClick`, она будет вызвана.
- Если определён глобальный `clickTag`, откроется ссылка.
- В противном случае — стандартное поведение (alert).

#### Проигрывание музыки и звуков:

```ts
// Для проигрывания фоновой музыки
PlayableComponent.instance.playMusic('music');

// Для проигрывания звука
PlayableComponent.instance.playSound('spin');

// Для разрешения проигрывания после первого взаимодействия
PlayableComponent.instance.firstInteraction();
```

---

## Важные вызовы в логике плеебла

- При первом взаимодействии пользователя обязательно вызывайте:

```ts
PlayableComponent.instance.firstInteraction();
```

- При показе endcard или скриншота обязательно вызывайте:

```ts
PlayableComponent.instance.gameEnd();
```

Это необходимо для корректной работы звука и аналитики завершения игры.

---

## Конфигурация через `.adapterrc`

> **Примечание:** `.adapterrc` — скрытый файл (начинается с точки). Убедитесь, что он находится в корне проекта и отображается в вашем файловом менеджере/IDE.

В корне проекта находится файл `.adapterrc`, который определяет параметры сборки и позволяет создавать несколько итераций с разными ссылками, каналами и папками для билдов. Пример структуры:

```json
{
  "buildPlatform": "web-mobile",
  "orientation": "auto",
  "user": "",
  "isZip": true,
  "extraFolderWrap": true,
  "enableSplash": false,
  "bgGradient": "radial-gradient(circle, #2a9142, #74b53b)",
  "iterations": [
    {
      "iosLink": "https://apps.apple.com",
      "androidLink": "https://play.google.com",
      "headForAll": "<script></script>",
      "versionFolder": "/version1",
      "naming": "(name) => `Playable_name_${name}`;",
      "exportChannels": ["Moloco", "AppLovin", "Unity", "Mintegral", "GooglePT", "GoogleLS", "Vungle", "IronSource"]
    }
  ]
}
```

- **iterations** — массив с вариантами сборки (разные ссылки, папки, каналы).
- **exportChannels** — список платформ для экспорта. Поддерживаются:
  - AppLovin
  - GooglePT
  - GoogleLS
  - AdColony
  - Chartboost
  - Snapchat
  - Unity
  - Mintegral
  - Facebook
  - Moloco
  - Liftoff
  - Tiktok
  - Vungle
  - IronSource
- **versionFolder** — папка для конкретной итерации билда.
- **iosLink/androidLink** — ссылки для перехода из креатива.
- **headForAll** — сюда можно добавить глобальные переменные (например, через <script>), которые будут доступны в коде плеебла для переключения между вариациями или передачи параметров.
- **bgGradient** — CSS фон загрузчика (background). 
- **logoPath** — путь к изображению логотипа для загрузчика (например, "assets/images/logo.png").
- **ctaPath** — путь к изображению CTA-кнопки на загрузчике (например, "assets/images/playNow.png").
- **user** — обязательный параметр для доступа к плагину сборки. Без него сборка playable невозможна. За логином обращайтесь к владельцу репозитория.

---

## Сборка и публикация

1. Настройте `.adapterrc` под нужные платформы и ссылки.
2. Соберите проект в Cocos Creator:
   - В меню выберите **Project > Build**.
   - В открывшемся окне выберите платформу **web-mobile**.
   - Переключатель **WebGL 2.0** выставьте в **OFF**.
   - Переключатель **Bundle mode of native code** выберите **asmjs**.
3. Запустите сборку и дождитесь формирования всех версий и папок
4. В результате получите папки с готовыми креативами для разных каналов.

**Важно:** итоговый размер креатива (архива или папки) не должен превышать **5 мегабайт** — это требование большинства рекламных сетей.

---

Если нужно добавить детали по запуску сборки или особенностям плагина — уточните, и я дополню инструкцию.
